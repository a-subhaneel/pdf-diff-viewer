<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PDF Diff Viewer - Example</title>

  <!-- PDF.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <!-- PDF Diff Viewer Library -->
  <script src="../src/PDFDiffViewer.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    .controls {
      background: #f5f5f5;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .controls h2 {
      margin-top: 0;
    }
    .file-input {
      margin: 10px 0;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #45a049;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    #results {
      margin-top: 20px;
    }
    .pdf-diff-summary {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <h1>PDF Diff Viewer - Embeddable Example</h1>
  
  <div class="controls">
    <h2>Select PDFs to Compare</h2>
    <div class="file-input">
      <label><strong>PDF A:</strong></label><br>
      <input type="file" id="fileA" accept="application/pdf">
    </div>
    <div class="file-input">
      <label><strong>PDF B:</strong></label><br>
      <input type="file" id="fileB" accept="application/pdf">
    </div>
    <button id="compareBtn" onclick="comparePDFs()">Compare PDFs</button>
    <button onclick="clearResults()">Clear Results</button>
  </div>

  <div id="results"></div>

  <script>
    let viewer = null;

    function comparePDFs() {
      const fileA = document.getElementById('fileA').files[0];
      const fileB = document.getElementById('fileB').files[0];

      if (!fileA || !fileB) {
        alert('Please select both PDF files!');
        return;
      }

      // Initialize viewer if not exists
      if (!viewer) {
        viewer = new PDFDiffViewer('#results', {
          scale: 3.0,
          colorTolerance: 120,
          labelA: 'Original Document',
          labelB: 'Modified Document',
          highlightAlpha: 0.32,
          showPageNumbers: true
        });
      }

      // Disable button during comparison
      const btn = document.getElementById('compareBtn');
      btn.disabled = true;
      btn.textContent = 'Comparing...';

      // Compare PDFs
      viewer.compare(fileA, fileB)
        .then(results => {
          console.log('Comparison complete!', results);
          console.log(`Total pages compared: ${results.totalPages}`);
          console.log(`Total diff pixels: ${results.totalDiffPixels}`);
          
          if (results.pageMapping) {
            console.log('Page mappings:', results.pageMapping);
          }
          
          btn.disabled = false;
          btn.textContent = 'Compare PDFs';
        })
        .catch(error => {
          console.error('Comparison failed:', error);
          alert('Error: ' + error.message);
          
          btn.disabled = false;
          btn.textContent = 'Compare PDFs';
        });
    }

    function clearResults() {
      if (viewer) {
        viewer.clear();
        viewer = null; // Reset viewer to apply new settings
      }
      document.getElementById('fileA').value = '';
      document.getElementById('fileB').value = '';
    }
  </script>
</body>
</html>
